<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de APIs Locales - DRTC Apur√≠mac</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #dc143c, #ffffff);
            color: white;
            border-radius: 5px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        input {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 200px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 3px;
            min-height: 50px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáµüá™ DRTC Apur√≠mac - Prueba de APIs</h1>
            <p>Sistema de Consulta DNI/RUC Local</p>
        </div>

        <div class="test-section">
            <h3>üÜî Consulta DNI</h3>
            <p>DNIs de prueba: 46027897, 12345678, 87654321, 70656153 (APISPERU)</p>
            <input type="text" id="dniInput" placeholder="Ingrese DNI (8 d√≠gitos)" maxlength="8">
            <button onclick="consultarDNI()">Consultar DNI</button>
            <button onclick="probarHibridoDNI()">Probar API H√≠brida</button>
            <button onclick="probarAPISPERU_DNI()">Probar APISPERU DNI</button>
            <div id="dniResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üè¢ Consulta RUC</h3>
            <p>RUCs de prueba: 10460278975, 20123456789, 20987654321, 20100070970 (APISPERU)</p>
            <input type="text" id="rucInput" placeholder="Ingrese RUC (11 d√≠gitos)" maxlength="11">
            <button onclick="consultarRUC()">Consultar RUC</button>
            <button onclick="probarHibridoRUC()">Probar API H√≠brida</button>
            <button onclick="probarAPISPERU_RUC()">Probar APISPERU RUC</button>
            <div id="rucResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Estado del Sistema</h3>
            <button onclick="verificarEstado()">Verificar Estado APIs</button>
            <div id="estadoResult" class="result"></div>
        </div>
    </div>

    <script>
        async function consultarDNI() {
            const dni = document.getElementById('dniInput').value.trim();
            const resultDiv = document.getElementById('dniResult');
            
            if (!dni || dni.length !== 8 || !/^\d+$/.test(dni)) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Error: DNI debe tener exactamente 8 d√≠gitos num√©ricos';
                return;
            }
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Consultando DNI...';
            
            try {
                const response = await fetch(`/Login-app/api/api-dni-local.php?dni=${dni}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>DNI encontrado:</strong><br>
                        <strong>Nombre:</strong> ${data.nombre_completo}<br>
                        <strong>Departamento:</strong> ${data.departamento}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        async function consultarRUC() {
            const ruc = document.getElementById('rucInput').value.trim();
            const resultDiv = document.getElementById('rucResult');
            
            if (!ruc || ruc.length !== 11 || !/^\d+$/.test(ruc)) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Error: RUC debe tener exactamente 11 d√≠gitos num√©ricos';
                return;
            }
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Consultando RUC...';
            
            try {
                const response = await fetch(`/Login-app/api/api-ruc-local.php?ruc=${ruc}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>RUC encontrado:</strong><br>
                        <strong>Raz√≥n Social:</strong> ${data.razon_social}<br>
                        <strong>Tipo:</strong> ${data.tipo_contribuyente}<br>
                        <strong>Estado:</strong> ${data.estado}<br>
                        <strong>Direcci√≥n:</strong> ${data.direccion}<br>
                        <strong>Departamento:</strong> ${data.departamento}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        async function verificarEstado() {
            const resultDiv = document.getElementById('estadoResult');
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = 'üîç Verificando estado de APIs...';
            
            const apis = [
                { name: 'API DNI H√≠brida', url: '/Login-app/api/api-dni-hibrido.php?dni=46027897' },
                { name: 'API RUC H√≠brida', url: '/Login-app/api/api-ruc-hibrido.php?ruc=10460278975' },
                { name: 'API DNI Local', url: '/Login-app/api/api-dni-local.php?dni=46027897' },
                { name: 'API RUC Local', url: '/Login-app/api/api-ruc-local.php?ruc=10460278975' },
                { name: 'APISPERU DNI', url: '/Login-app/api/test-apisperu-dni.php?dni=70656153' },
                { name: 'APISPERU RUC', url: '/Login-app/api/test-apisperu-ruc.php?ruc=20100070970' }
            ];
            
            let resultados = '<h4>üìä Estado de las APIs:</h4>';
            
            for (const api of apis) {
                try {
                    const start = Date.now();
                    const response = await fetch(api.url);
                    const time = Date.now() - start;
                    const data = await response.json();
                    
                    if (data.success) {
                        resultados += `‚úÖ <strong>${api.name}:</strong> Operativa (${time}ms)<br>`;
                    } else {
                        resultados += `‚ö†Ô∏è <strong>${api.name}:</strong> Error en respuesta<br>`;
                    }
                } catch (error) {
                    resultados += `‚ùå <strong>${api.name}:</strong> No disponible<br>`;
                }
            }
            
            resultados += `<br><small>Verificaci√≥n completada: ${new Date().toLocaleString()}</small>`;
            
            resultDiv.className = 'result success';
            resultDiv.innerHTML = resultados;
        }
        
        // Nuevas funciones para probar APIs h√≠bridas
        async function probarHibridoDNI() {
            const dni = document.getElementById('dniInput').value.trim() || '70656153';
            const resultDiv = document.getElementById('dniResult');
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Probando API H√≠brida DNI (APISPERU + Local)...';
            
            try {
                const response = await fetch(`/Login-app/api/api-dni-hibrido.php?dni=${dni}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>API H√≠brida DNI Exitosa:</strong><br>
                        <strong>DNI:</strong> ${data.dni}<br>
                        <strong>Nombre Completo:</strong> ${data.nombre_completo}<br>
                        <strong>Nombres:</strong> ${data.nombres}<br>
                        <strong>Ap. Paterno:</strong> ${data.apellido_paterno}<br>
                        <strong>Ap. Materno:</strong> ${data.apellido_materno}<br>
                        <strong>Departamento:</strong> ${data.departamento || 'N/A'}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error API H√≠brida: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        async function probarHibridoRUC() {
            const ruc = document.getElementById('rucInput').value.trim() || '20100070970';
            const resultDiv = document.getElementById('rucResult');
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Probando API H√≠brida RUC (APISPERU + Local)...';
            
            try {
                const response = await fetch(`/Login-app/api/api-ruc-hibrido.php?ruc=${ruc}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>API H√≠brida RUC Exitosa:</strong><br>
                        <strong>RUC:</strong> ${data.ruc}<br>
                        <strong>Raz√≥n Social:</strong> ${data.razon_social}<br>
                        <strong>Estado:</strong> ${data.estado}<br>
                        <strong>Condici√≥n:</strong> ${data.condicion || 'N/A'}<br>
                        <strong>Direcci√≥n:</strong> ${data.direccion}<br>
                        <strong>Departamento:</strong> ${data.departamento}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error API H√≠brida: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        // Nuevas funciones para probar APISPERU espec√≠ficamente
        async function probarAPISPERU_DNI() {
            const dni = document.getElementById('dniInput').value.trim() || '70656153';
            const resultDiv = document.getElementById('dniResult');
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Probando API APISPERU DNI...';
            
            try {
                const response = await fetch(`/Login-app/api/test-apisperu-dni.php?dni=${dni}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>APISPERU DNI Exitoso:</strong><br>
                        <strong>DNI:</strong> ${data.dni}<br>
                        <strong>Nombre:</strong> ${data.nombre_completo}<br>
                        <strong>Nombres:</strong> ${data.nombres}<br>
                        <strong>Ap. Paterno:</strong> ${data.apellidoPaterno}<br>
                        <strong>Ap. Materno:</strong> ${data.apellidoMaterno}<br>
                        <strong>C√≥digo Verificaci√≥n:</strong> ${data.codVerifica}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error APISPERU: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        async function probarAPISPERU_RUC() {
            const ruc = document.getElementById('rucInput').value.trim() || '20100070970';
            const resultDiv = document.getElementById('rucResult');
            
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Probando API APISPERU RUC...';
            
            try {
                const response = await fetch(`/Login-app/api/test-apisperu-ruc.php?ruc=${ruc}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>APISPERU RUC Exitoso:</strong><br>
                        <strong>RUC:</strong> ${data.ruc}<br>
                        <strong>Raz√≥n Social:</strong> ${data.razon_social}<br>
                        <strong>Nombre Comercial:</strong> ${data.nombre_comercial || 'N/A'}<br>
                        <strong>Estado:</strong> ${data.estado}<br>
                        <strong>Condici√≥n:</strong> ${data.condicion}<br>
                        <strong>Direcci√≥n:</strong> ${data.direccion}<br>
                        <strong>Departamento:</strong> ${data.departamento}<br>
                        <strong>Capital:</strong> ${data.capital}<br>
                        <strong>Tel√©fonos:</strong> ${data.telefonos ? data.telefonos.join(', ') : 'N/A'}<br>
                        <strong>Fuente:</strong> ${data.fuente}<br>
                        <small>Timestamp: ${data.timestamp}</small>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error APISPERU: ${data.error}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        // Auto-verificar al cargar la p√°gina
        window.onload = function() {
            setTimeout(verificarEstado, 1000);
        };
    </script>
</body>
</html>
